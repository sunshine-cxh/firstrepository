<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./css/reset.css">
  <link rel="stylesheet" href="./css/index.css">
</head>
<body style="height: 50000px;">
  <div class="out_wrapper">
     <!-- 头部 -->
     <div class="header">
      <!-- 头部第一行 -->
      <div class="top">
        <div class="container">
            <!-- 左边菜单 -->
          <div class="left_list">
            <p>尚品汇欢迎您
              ！</p>
            <p>
              <span>请</span>
              <a href="#" class="register">登录</a>
              <a href="#">免费注册</a>
            </p>
          </div>
          <!-- 右边菜单 -->
          <div class="right_list">
            <a href="#">我的订单</a>
            <a href="#">我的购物车</a>
            <a href="#">我的尚品汇</a>
            <a href="#">尚品汇会员</a>
            <a href="#">企业采购</a>
            <a href="#">关注尚品汇</a>
            <a href="#">合作招商</a>
            <a href="#">商家后台</a>
          </div>
        </div>
      </div>
      <div class="bottom">
        <h1 class="logoArea">
          <a href="#" class="logo">
            <img src="./images/Logo.png" alt="尚品汇">
          </a>
        </h1>
        <div class="searchArea">
          <form action="#" class="searchForm">
            <input type="text" class="inputSearch">
            <button type="submit">搜索</button>
          </form>
        </div>
      </div>
      <!-- 全部商品分类 -->
      <div class="all_goods">
        <div class="type_wrap">
          <div class="left_list">
            <h2>全部商品分类</h2>
          </div>
          <div class="right_list">
            <a href="#">服装城</a>
            <a href="#">美妆馆</a>
            <a href="#">尚品汇超市</a>
            <a href="#">全球购</a>
            <a href="#">闪购</a>
            <a href="#">团购</a>
            <a href="#">有趣</a>
            <a href="#">秒杀</a>
          </div>
        </div>
      </div>
    </div>
    <!--商品主要内容区域-->
    <section class="con">
      <!--路径导航-->
      <div class="conPoin">
          <a href="###">手机、数码、通讯</a>
          <a href="###">手机</a>
          <a href="###">Apple苹果</a>
          <a >iphone 6S系类</a>
      </div>
      <!--主要内容区域-->
      <div class="mainCon">
          <!--左侧放大镜-->
          <div class="previewWrap">
              <!--放大镜效果-->
              <div class="preview">
                  <!--小图-->
                  <div class="zoom">
                      <img src="./images/s1.png" alt="">
                  </div>
                  <!--大图-->
              </div>
              <!--缩略图效果-->
              <div class="specScroll">
                  <a class="prev">&lt;</a>
                  <div class="itemCon">
                      <ul class="list">
                          <li><img src="./images/s1.png" alt=""></li>
                          <li><img src="./images/s2.png" alt=""></li>
                          <li><img src="./images/s3.png" alt=""></li>
                          <li><img src="./images/s1.png" alt=""></li>
                          <li><img src="./images/s2.png" alt=""></li>
                          <li><img src="./images/s3.png" alt=""></li>
                          <li><img src="./images/s1.png" alt=""></li>
                          <li><img src="./images/s2.png" alt=""></li>
                      </ul>
                  </div>
                  <a class="next">&gt;</a>
              </div>
          </div>
          <!--右侧商品信息-->
          <div class="right_con">
            <div class="first">
              <h3>Apple iPhone 6s（A1700）64G玫瑰金色 移动通信电信4G手机</h3>
              <p>推荐选择下方[移动优惠购],手机套餐齐搞定,不用换号,每月还有话费返</p>
              <div class="bg_pink">
                <div class="priceArea">
                  <div class="priceArea1">
                    <div class="title">价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</div>
                    <div class="price">
                      <i>￥</i>
                      <em>5299</em>
                      <span>降价通知</span>
                    </div>
                    <!-- 累计评价 -->
                    <div class="num">
                      <i>累计评价</i>
                      <span>9999+</span>
                    </div>
                  </div>
                  <!-- 促销 -->
                  <div class="priceArea2">
                    <div class="title">促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</div>
                    <div class="low_price">
                      <i class="bg_red">加购价</i>
                      <em class="little_words">满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品</em>
                    </div>
                  </div>
                </div>
                <div class="new">
                  <div class="one">支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</div>
                  <div class="gifts">以旧换新，闲置手机回收 4G套餐超值抢 礼品购</div>
                </div>
                <div class="to">
                  <div class="two">配 送 至</div>
                  <div class="province">广东省 深圳市 宝安区</div>
                </div>
              </div>
            </div>
            <div class="second">
              <div class="dlOld">
                <div class="choosed">
                </div>
              </div>
              <div class="shopping">
                <input type="text" value="1">
                <a href="###" class="plus">+</a>
                <a href="###" class="mins">-</a>
              </div>
              <div class="shop_car">
                <a href="###">加入购物车</a>
              </div>
            </div>
          </div>
      </div>
    </section>
  </div>
<script src="./js/data.js"></script>
<script>
  window.addEventListener('DOMContentLoaded',function(){
    //声明一个全局变量来保存缩略图点击的图片下标
    var magnifierImgID = 0;
    function getStyle(obj,attr) {
          if(obj.currentStyle){
            return obj.currentStyle[attr];
          }else{
              return document.defaultView.getComputedStyle(obj,null)[attr];
          }
        }
    magnifier();
    // 1、放大镜
    function magnifier(){
      var imgSrc = [
                { b: "./images/b1.png ", s: "./images/s1.png" },
                { b: "./images/b2.png", s: "./images/s2.png" },
                { b: "./images/b3.png", s: "./images/s3.png" },
                { b: "./images/b1.png", s: "./images/s1.png" },
                { b: "./images/b2.png", s: "./images/s2.png" },
                { b: "./images/b3.png", s: "./images/s3.png" },
                { b: "./images/b1.png", s: "./images/s1.png" },
                { b: "./images/b2.png", s: "./images/s2.png" }
            ];
      var imgItem = document.querySelector('.out_wrapper .con .mainCon .previewWrap .preview .zoom > img');
      imgItem.src = imgSrc[magnifierImgID].s;
      // 放大镜外层容器
      var preview = document.querySelector('.out_wrapper .con .mainCon .previewWrap .preview');
      // 小图容器
      var smallBox = document.querySelector('.out_wrapper .con .mainCon .previewWrap .preview .zoom');
      // 初始化蒙版
      var mask = null;
      var bigBox = null;
      var bigImg = null;
      // 绑定鼠标移入移出事件
      preview.onmouseenter = function(){
        if(!mask){
          // 创建蒙版
          mask = document.createElement('div');
          mask.className = 'mask';
          smallBox.appendChild(mask);
          bigBox = document.createElement('div');
          bigBox.className = 'bigBox';
          bigImg = new Image();
          bigImg.src = imgSrc[magnifierImgID].b;
          bigBox.appendChild(bigImg);
          preview.appendChild(bigBox);
        }
        smallBox.onmousemove = function(event){
          // 蒙版位置
          var maskPosition = {
            left:event.clientX - mask.offsetWidth / 2 - smallBox.getBoundingClientRect().left,
            top:event.clientY - mask.offsetHeight / 2 - smallBox.getBoundingClientRect().top
          }
          // 判断边界  小于最小值 等于最小值  大于最大值 等于最大值
          if(maskPosition.left < 0){
            maskPosition.left = 0;
          }else if(maskPosition.left > smallBox.clientWidth - mask.offsetWidth){
            maskPosition.left = smallBox.clientWidth - mask.offsetWidth;
          }
          if(maskPosition.top < 0){
            maskPosition.top = 0;
          }else if(maskPosition.top > smallBox.clientHeight- mask.offsetHeight){
            maskPosition.top = smallBox.clientHeight - mask.offsetHeight;
          }
          // 蒙版位置
          mask.style.left = maskPosition.left + 'px';
          mask.style.top = maskPosition.top + 'px';
          var scale = (smallBox.clientWidth - mask.offsetWidth) / ( bigImg.offsetWidth-bigBox.clientWidth)
          var bigPosition = {
              left:maskPosition.left / scale,
              top:maskPosition.top / scale
          }
//           大图修位置
          bigImg.style.marginLeft = -bigPosition.left + 'px';
          bigImg.style.marginTop = -bigPosition.top + 'px';
        };
        preview.onmouseleave = function () {
          smallBox.removeChild(mask);
          preview.removeChild(bigBox);
          mask = null;
          bigBox = null;
          bigImg = null;
//                解绑事件
          smallBox.onmousemove = null;
          preview.onmouseleave = null;
        }
      }
    }
    // 2、缩略图
    scroll();
    function scroll(){
       // 获取移动图片容器（超长的）
       var list = document.querySelector('.out_wrapper .con .mainCon .specScroll .itemCon .list');
    // 获取图片集合
    var items = document.querySelectorAll('.out_wrapper .con .mainCon .specScroll .itemCon .list > li ');
    // 获取左右两个按钮
    var prev = document.querySelector('.out_wrapper .con .mainCon .specScroll .prev');
    var next = document.querySelector('.out_wrapper .con .mainCon .specScroll .next');
    // 图片可见张数
    var showImg = 5;
    // 移动的张数
    var num = 2;
    var imgLength = (items[0].offsetWidth + parseInt(getStyle(items[0],'marginRight')));
    // 一共可移动的距离
    var countLeft = (items.length-showImg)*(items[0].offsetWidth + parseInt(getStyle(items[0],'marginRight')));
    // 每次移动的距离
    var moveLength = imgLength*num;
    // 已经走到距离
    var tempLength = 0;
    // 绑定按钮点击事件
    next.onclick = function(){
      console.log(countLeft);
      // 已经走的总距离小于可以被走的总距离 就可以继续走
      if(tempLength<countLeft){
        // 剩余可移动距离 大于 单次移动距离 就走该走的距离
        if(countLeft-tempLength>moveLength){
          tempLength += moveLength;
        }else{
        // 剩余可移动距离 小于 单次移动距离 就走剩余的距离 就走剩余的距离
        tempLength += (countLeft - tempLength);
        }
        list.style.left = -tempLength + 'px'; 
        
      }
    }
    prev.onclick = function(){
      if(tempLength > 0){
        if(tempLength > moveLength){
          tempLength -= moveLength;
        }else{
          tempLength = 0;
        }
        list.style.left = -tempLength + 'px';
      }
    }
  }
    // 3、点击缩略图的效果
    scrollClick();
    function scrollClick(){
      // 获取容器中所有图片的集合
      var imgItems = document.querySelectorAll('.out_wrapper .con .mainCon .specScroll .itemCon .list > li img');
      // 获取滚动上面的小图
      var imgItem = document.querySelector('.out_wrapper .con .mainCon .previewWrap .preview .zoom > img');
      // 图片绑定点击事件
      for(var i=0; i < imgItems.length; i++){
        imgItems[i].onclick = function(){
          for(var i=0; i < imgItems.length; i++){
            if(imgItems[i] == this){
              magnifierImgID = i;
              imgItem.src = this.src;
            }
          }
        }
      }
    }
    // 4、商品筛选详情   动态数据加载
    screening();
    function screening(){
      var crumbData = [
              {
                  'title':'选择颜色',
                  'data':['金色','银色','黑色']
              },
              {
                  'title':'内存容量',
                  'data':['16G','64G','128G','256G']
              },
              {
                  'title':'选择版本',
                  'data':['公开版','移动版']
              },
              {
                  'title':'购买方式',
                  'data':['官方标配','优惠移动版','电信优惠版']
              }
          ];
      // 获取父容器
      var secondNode = document.querySelector('.out_wrapper .con .right_con .second .dlOld');
      crumbData.forEach(function(item){
        // 创建dl
        var dlNode = document.createElement('dl');
        var dtNode = document.createElement('dt');
        dtNode.innerHTML = item.title;
        dlNode.appendChild(dtNode);
        // 继续遍历item里面的data
        item.data.forEach(function(item){
          var ddNode = document.createElement('dd');
          ddNode.innerHTML = item;
          dlNode.appendChild(ddNode);
        });
        secondNode.appendChild(dlNode);
      });


      // 筛选交互
      // 获取所有的dl
      var dlList = secondNode.getElementsByTagName('dl');
      var arr = new Array(crumbData.length);
      arr.fill(0);
      // 遍历所有的dl
      for(var i = 0; i < dlList.length; i++){
        dlList[i].index = i;
        ~function(){
          var ddNode = dlList[i].getElementsByTagName('dd');
        // 所有dd绑定点击事件
          for(var j = 0; j < ddNode.length; j++){
            ddNode[j].onclick = function(){
              for(var i = 0; i < ddNode.length; i++){
                // 讲颜色恢复为#666
                ddNode[i].style.color = "#666";
              }
              this.style.color = "red";
              // 修改数组
              arr[this.parentNode.index]=this.innerHTML;
              var choosed = document.querySelector('.out_wrapper .con .right_con .second .dlOld .choosed');
              choosed.innerHTML = '';
              arr.forEach(function(item,index){
                // 当数组不为空的时候创建mark
                if(item){
                  var markNode = document.createElement('mark');
                  markNode.innerHTML = item;
                  var choosed = document.querySelector('.out_wrapper .con .right_con .second .dlOld .choosed ');
                  var delA = document.createElement('a');
                  delA.innerHTML = 'X';
                  markNode.appendChild(delA);
                  delA.setAttribute('num',index);
                  choosed.appendChild(markNode);
                }
              });
              // 删除功能
              // 获取mark中的所有a标签
              var aList = choosed.querySelectorAll('mark>a');
              for(var i = 0; i < aList.length; i++){
                aList[i].onclick = function(){
                  // 用一个变量存储点击的a是第几个dl
                  var num = parseInt(this.getAttribute('num'));
                  // 删除当前a对应的mark
                  this.parentNode.parentNode.removeChild(this.parentNode);
                  var ddNode = dlList[num].querySelectorAll('dd');
                  for( var j = 0; j < ddNode.length; j++){
                    ddNode[j].style.color = '#666';
                  }
                  dlList[num].querySelector('dd:nth-of-type(1)').style.color = 'red';
                  arr[num] = 0;
                }
              }
            }
          }
        }();
      }
    }
    // 5、数量删减功能
    var plus = document.querySelector('.out_wrapper .con .right_con .second .shopping .plus')
    var mins = document.querySelector('.out_wrapper .con .right_con .second .shopping .mins')
    var input = document.querySelector('.out_wrapper .con .right_con .second .shopping input')
    var num = 1;
    plus.onclick = function(){
      num++;
      input.value = num;
    }
    mins.onclick = function(){
      if(num>1){
        num--;
        input.value = num;
      }
    }
    //      商品详情的数据动态生成
    goodsDetail();
      function goodsDetail() {
//          获取数据
        var goodsData = goodData.goodsDetail;
//          获取容器
        var firstNode = document.querySelector('.out_wrapper .con .right_con .first');
//       es6模板字符串   后续字符串拼接事件数据添加的操作 都是使用这种方式
        var str = ` <h3>${goodsData.title}</h3>
              <p>推荐选择下方[移动优惠购],手机套餐齐搞定,不用换号,每月还有话费返</p>
              <div class="bg_pink">
                <div class="priceArea">
                  <div class="priceArea1">
                    <div class="title">价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</div>
                    <div class="price">
                      <i>￥</i>
                      <em>${goodsData.price}</em>
                      <span>降价通知</span>
                    </div>
                    <!-- 累计评价 -->
                    <div class="num">
                      <i>累计评价</i>
                      <span>${goodsData.evaluateNum}</span>
                    </div>
                  </div>
                  <!-- 促销 -->
                  <div class="priceArea2">
                    <div class="title">促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</div>
                    <div class="low_price">
                      <i class="bg_red">${goodsData.promoteSales.type}</i>
                      <em class="little_words">${goodsData.promoteSales.content}</em>
                    </div>
                  </div>
                </div>
                <div class="new">
                  <div class="one">支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</div>
                  <div class="gifts">${goodsData.support}</div>
                </div>
                <div class="to">
                  <div class="two">配 送 至</div>
                  <div class="province">${goodsData.address}</div>
                </div>
              </div>`;
          firstNode.innerHTML = str;
      }





    
  })
</script>
</body>
</html>